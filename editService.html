<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Service</title>

      <meta name="viewport" content="width=device-width, initial-scale=1.0">

 <!-- this page is not required just to make the page more intractive -->
  <link id="theme-style" rel="stylesheet" href="style-light.css">
</head>

<body class="sp-page">
 
       <!-- Navbar -->
  <header class="navbar">
    <div class="nav-container">

      <div class="nav-logo">
        <a href="index.html">
          <img src="images/sanad.png" alt="sanad logo">
        </a>
      </div>

      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="services.html" class="border-left">Services</a>
        <a href="customer-dashboard.html" class="border-left">Customer</a>
        <a href="ServiceProvider.html" class="current border-left">Service Provider</a>
        <a href="about.html" class="border-left">About Us</a>
      </nav>
    </div>
  </header>

  <div class="nav-line"></div>

  <!-- ===== Breadcrumbs ===== -->
  <nav class="breadcrumbs dark">
    <ol class="trail nav-container">
      <li><a href="index.html">Home</a></li>
      <li><a href="ServiceProvider.html">Service Provider</a></li>
      <li>Edit Service</li>
    </ol>
  </nav>

  <!-- ===== Main Content ===== -->
  <main class="container">

    <section class="page-title-container">
      <h1 class="page-title">Edit Service</h1>
      <!-- Simple helper text -->
      <p>Use this form to update the selected service information.</p>
    </section>

    <!-- Edit form -->
    <section class="join-section">
      <h2>Service Details</h2>

     
      <form class="addService-form" action="#" method="post" enctype="multipart/form-data">
        <div class="form-header">
          <!-- Back to provider dashboard -->
          <a href="ServiceProvider.html" title="Back to Provider Dashboard">×</a>
        </div>

        <!-- Service name -->
        <label>
          Service Name
          <input type="text" name="name" placeholder="Enter service name" required>
        </label>
        <label class="file-field">
          Service Photo
          <input type="file" name="photo" accept="image/*">
        </label>

        <label>
          Price (SR)
          <input type="text" name="price" placeholder="Enter service price" required>
        </label>

        <label>
          Quantity
          <input type="number" name="quantity" min="0" placeholder="Enter available quantity">
        </label>

        <label class="full">
          Description
          <textarea name="description" rows="4" placeholder="Update the service description" required></textarea>
        </label>

        <div class="form-actions full">
          <button type="submit" class="btn btn-dark">Save Changes</button>
        </div>

      </form>
    </section>

  </main>

  <!-- ===== Footer ===== -->
  <footer class="site-footer">
    <div class="container footer-box">
      <div class="footer-grid">
        <div class="footer-col">
          <h4>Find us</h4>
          <ul class="social">
            <li><a href="#" aria-label="X">X</a></li>
            <li><a href="#" aria-label="Facebook">f</a></li>
            <li><a href="#" aria-label="LinkedIn">in</a></li>
          </ul>
        </div>

        <div class="footer-col center">
          <div class="brand">
            <img src="images/sanad.png" alt="Sanad logo">
          </div>
          <small>©2025 Sanad. All rights reserved</small>
        </div>

        <div class="footer-col right">
          <h4>contact Info</h4>
          <p>+966537282741</p>
          <p><a href="mailto:sanadservices@gmail.com">sanadservices@gmail.com</a></p>
        </div>
      </div>
    </div>
  </footer>


   <script>
   
   document.addEventListener("DOMContentLoaded", function() {
  // Load the service data to edit
  const editName = localStorage.getItem("edit_name");
  const editPrice = localStorage.getItem("edit_price");
  const editDescription = localStorage.getItem("edit_description");
  const editIndex = localStorage.getItem("edit_index");

  console.log("Loading edit data:", { editIndex, editName, editPrice, editDescription });

  // Pre-fill the form with existing data
  if (editName) {
    document.querySelector("input[name='name']").value = editName;
  }
  if (editPrice) {
    document.querySelector("input[name='price']").value = editPrice;
  }
  if (editDescription) {
    document.querySelector("textarea[name='description']").value = editDescription;
  }

  // Handle form submission
  document.querySelector(".addService-form").addEventListener("submit", function(e) {
    e.preventDefault();

    // Get the original index to know which service to update
    const originalIndex = localStorage.getItem("edit_index");

    // Get form values
    const updatedName = document.querySelector("input[name='name']").value.trim();
    const updatedPrice = document.querySelector("input[name='price']").value.trim();
    const updatedDescription = document.querySelector("textarea[name='description']").value.trim();
    const photoInput = document.querySelector("input[name='photo']");

    console.log("Form values:", { updatedName, updatedPrice, updatedDescription });

    // Validation
    if (!updatedName || !updatedPrice || !updatedDescription) {
      alert("Please fill in all fields!");
      return;
    }

    if (/^[0-9]/.test(updatedName)) {
      alert("Name cannot start with a number!");
      return;
    }

    if (isNaN(updatedPrice) || Number(updatedPrice) <= 0) {
      alert("Price must be a valid positive number!");
      return;
    }

    // Handle photo upload if a new photo is selected
    if (photoInput.files.length > 0) {
      const file = photoInput.files[0];
      
      // Check file size (limit to 2MB)
      if (file.size > 2 * 1024 * 1024) {
        alert("Image size should be less than 2MB!");
        return;
      }

      // Convert image to Data URL
      const reader = new FileReader();
      reader.onload = function(e) {
        // Save updated data with the new photo
        saveUpdatedData(updatedName, updatedPrice, updatedDescription, e.target.result, originalIndex);
      };
      reader.readAsDataURL(file);
    } else {
      // No new photo selected, keep the existing photo
      const services = JSON.parse(localStorage.getItem("services")) || [];
      const existingPhoto = services[originalIndex] ? services[originalIndex].photo : null;
      saveUpdatedData(updatedName, updatedPrice, updatedDescription, existingPhoto, originalIndex);
    }
  });

  function saveUpdatedData(name, price, description, photoData, index) {
    // Save updated data with the original index
    localStorage.setItem("updated_name", name);
    localStorage.setItem("updated_price", price);
    localStorage.setItem("updated_description", description);
    localStorage.setItem("updated_photo", photoData); // Save the photo data
    localStorage.setItem("updated_index", index);

    console.log("Saving updated data:", {
      name: name,
      price: price,
      description: description,
      hasPhoto: !!photoData,
      index: index
    });

    // Clean up edit data
    localStorage.removeItem("edit_name");
    localStorage.removeItem("edit_price");
    localStorage.removeItem("edit_description");
    localStorage.removeItem("edit_index");

    alert("Service updated successfully!");
    window.location.href = "ServiceProvider.html";
  }
}); 
</script>


  <script src="theme.js"></script>
</body>
</html>
